/**
 * ğŸ“Š gm (Transconductance) ê³„ì‚° ëª¨ë“ˆ
 * 
 * ğŸ“– ë¬¼ë¦¬ì  ì˜ë¯¸:
 * - ê²Œì´íŠ¸ ì „ì••ì´ ë“œë ˆì¸ ì „ë¥˜ë¥¼ ì–¼ë§ˆë‚˜ íš¨ê³¼ì ìœ¼ë¡œ ì œì–´í•˜ëŠ”ì§€ë¥¼ ì •ëŸ‰í™”
 * - ì†Œìì˜ ì „ë¥˜ ì¦í­ ëŠ¥ë ¥ì„ ë‚˜íƒ€ë‚´ëŠ” ì²™ë„
 * - gm ê°’ì´ ë†’ì„ìˆ˜ë¡ ê²Œì´íŠ¸ ì œì–´ê°€ ìš°ìˆ˜í•˜ê³  ì¦í­ ëŠ¥ë ¥ì´ ê°•í•¨
 * 
 * ğŸ“ ì¸¡ì • ë°ì´í„°: IDVG-Linear ë˜ëŠ” IDVG-Saturation
 * - ì—‘ì…€ íŒŒì¼ì— gm ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
 * - ì—†ìœ¼ë©´ ID-VG ë°ì´í„°ë¡œë¶€í„° ìˆ˜ì¹˜ ë¯¸ë¶„ìœ¼ë¡œ ê³„ì‚°
 * 
 * ğŸ§® ê³„ì‚° ìˆ˜ì‹: gm = Î”ID / Î”VG (ë¯¸ë¶„)
 * - ìˆ˜ì¹˜ ë¯¸ë¶„: 3ì ì„ ì‚¬ìš©í•œ ì¤‘ì•™ ì°¨ë¶„ë²•
 * - gm[i] = (ID[i+1] - ID[i-1]) / (VG[i+1] - VG[i-1])
 * - ë…¸ì´ì¦ˆë¥¼ ì¤„ì´ê³  ì •í™•ë„ë¥¼ ë†’ì´ëŠ” ë°©ë²•
 * 
 * ğŸ“Š ë‹¨ìœ„: S (ì§€ë©˜ìŠ¤) = A/V
 */

export const calculateGm = (chartData) => {
  // ì…ë ¥ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (ìµœì†Œ 3ê°œ ì  í•„ìš”)
  if (!chartData || chartData.length < 3) return [];
  
  const gmData = [];
  
  // ğŸ§® ìˆ˜ì¹˜ ë¯¸ë¶„ìœ¼ë¡œ gm ê³„ì‚° (3ì  ì¤‘ì•™ ì°¨ë¶„ë²•)
  // ì²« ë²ˆì§¸ì™€ ë§ˆì§€ë§‰ ì ì€ ì œì™¸ (ë¯¸ë¶„ ê³„ì‚°ì„ ìœ„í•´ ì–‘ìª½ ì ì´ í•„ìš”)
  for (let i = 1; i < chartData.length - 1; i++) {
    // VG ê°„ê²© ê³„ì‚° (ì „ì²´ ê°„ê²©ì„ ì‚¬ìš©í•˜ì—¬ ì •í™•ë„ í–¥ìƒ)
    const deltaVG = chartData[i+1].VG - chartData[i-1].VG;
    
    // ID ë³€í™”ëŸ‰ ê³„ì‚°
    const deltaID = chartData[i+1].ID - chartData[i-1].ID;
    
    // gm ê³„ì‚°: gm = Î”ID / Î”VG
    if (deltaVG !== 0) {
      const gm = Math.abs(deltaID / deltaVG);  // ì ˆëŒ€ê°’ ì‚¬ìš© (ë°©í–¥ì„±ë³´ë‹¤ í¬ê¸° ì¤‘ìš”)
      gmData.push({ 
        VG: chartData[i].VG,  // ì¤‘ì•™ì ì˜ VG ê°’
        gm: gm 
      });
    }
  }
  
  return gmData;
};